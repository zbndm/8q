import{l as w,c as v,e as D}from"./chunk-NXTRM26X.a75724e8.js";import{a as m,P as N,D as O,C as b,c as T,M as a,g as P}from"./chunk-7NOROMYZ.f0d1f7d8.js";import{i as M}from"./icons.c6dd0c65.js";w("Background script working.");let l=-1;chrome.tabs.onActivated.addListener(({tabId:t})=>l=t);class g{constructor(e,n){this.tabId=e,this.toContent=n.toContent,this.fromContent=n.fromContent,this.forwardToDevtools=n.forwardToDevtools,this.forwardToClient=n.forwardToClient}connected=!0;versions;solidOnPage=!1;disconnectListeners=v();connectListeners=new Set;toContent;fromContent;forwardToDevtools;forwardToClient;onContentScriptConnect(e){return this.connected&&e(this.toContent.bind(this),this.fromContent.bind(this)),this.connectListeners.add(e),()=>this.connectListeners.delete(e)}reconnected(e){this.toContent=e.toContent,this.fromContent=e.fromContent,this.forwardToDevtools=e.forwardToDevtools,this.forwardToClient=e.forwardToClient,this.connected=!0,this.connectListeners.forEach(n=>n(this.toContent.bind(this),this.fromContent.bind(this)))}onContentScriptDisconnect(e){this.disconnectListeners.push(e)}disconnected(){this.connected=!1,this.disconnectListeners.execute(),this.forwardToClient=()=>{},this.forwardToDevtools=()=>{}}}const C=new Map;let f,d;function L(t,e){const{onPortMessage:n,postPortMessage:i}=T(t);let r,o;const c={toContent:i,fromContent:n,forwardToDevtools:s=>r=s,forwardToClient:s=>t.postMessage(s)};e===d?(o=f,o.reconnected(c)):o=new g(e,c),d=void 0,d=void 0,C.set(e,o),a(n,"Versions",s=>{o.versions=s,chrome.action.setIcon({tabId:e,path:M.normal})}),a(n,"SolidOnPage",()=>o.solidOnPage=!0),t.onDisconnect.addListener(()=>{o.disconnected(),C.delete(e),f=o,d=e}),t.onMessage.addListener(s=>{r&&P(s)&&r(s)})}function h(t,e){const n=C.get(l);if(!n)return D("No data for active tab",l);const i=T(t);e(n,i)}function S(t){h(t,(e,{postPortMessage:n})=>{e.onContentScriptConnect((i,r)=>{e.versions?n("Versions",e.versions):a(r,"Versions",o=>n("Versions",o)),t.onDisconnect.addListener(()=>i("DevtoolsClosed"))})})}function V(t){h(t,(e,{postPortMessage:n,onForwardMessage:i})=>{e.onContentScriptConnect((r,o)=>{const c=s=>{n("Versions",s),r("DevtoolsOpened")};e.versions?c(e.versions):a(o,"Versions",c),o("ResetPanel",()=>n("ResetPanel")),e.onContentScriptDisconnect(()=>n("ResetPanel")),e.forwardToDevtools(s=>{t.postMessage(s)}),i(s=>e.forwardToClient(s))})})}function u(t){h(t,(e,{postPortMessage:n})=>{const{fromContent:i,versions:r,solidOnPage:o}=e;r?n("Versions",r):o?(n("SolidOnPage"),a(i.bind(e),"Versions",c=>n("Versions",c))):(a(i.bind(e),"Versions",c=>n("Versions",c)),a(i.bind(e),"SolidOnPage",()=>n("SolidOnPage")))})}chrome.runtime.onConnect.addListener(t=>{switch(t.name){case b:t.sender?.tab?.id&&L(t,t.sender.tab.id);break;case O:S(t);break;case N:V(t);break;case m:u(t);break}});
